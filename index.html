<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GPS Incident Report</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body class="bg-gray-100">
  <div class="max-w-2xl mx-auto bg-white shadow-md rounded-lg p-6 mt-8">
    <!-- Company Logo -->
    <div class="flex justify-center mb-6">
      <img src="log.jpg" alt="Company Logo" class="h-16 object-contain" />
    </div>

    <h2 class="text-2xl font-bold mb-4 text-center">GPS Damage / Lost Incident Report</h2>
    <form id="incidentForm" class="space-y-4">
      <div>
        <label class="block font-medium">Reporter Name</label>
        <input type="text" name="reporter" class="w-full border rounded p-2" required />
      </div>
      <div>
        <label class="block font-medium">Device ID / IMEI</label>
        <input type="text" name="deviceId" class="w-full border rounded p-2" required />
      </div>
      <div>
        <label class="block font-medium">Incident Type</label>
        <select name="incidentType" class="w-full border rounded p-2" required>
          <option value="Damage">Damage</option>
          <option value="Lost">Lost</option>
        </select>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block font-medium">Date</label>
          <input type="date" name="date" class="w-full border rounded p-2" required />
        </div>
        <div>
          <label class="block font-medium">Time</label>
          <input type="time" name="time" class="w-full border rounded p-2" required />
        </div>
      </div>
      <div>
        <label class="block font-medium">Location</label>
        <input type="text" name="location" class="w-full border rounded p-2" required />
      </div>
      <div>
        <label class="block font-medium">Description</label>
        <textarea name="description" class="w-full border rounded p-2" required></textarea>
      </div>
      <div>
        <label class="block font-medium">Reference Number (Optional)</label>
        <input type="text" name="reference" class="w-full border rounded p-2" />
      </div>
      <div>
        <label class="block font-medium">Attach Photo</label>
        <input type="file" id="photo" accept="image/*" class="w-full" />
      </div>
      <div>
        <button type="button" onclick="generatePDF()" class="bg-blue-600 text-white px-4 py-2 rounded">Export as PDF</button>
      </div>
    </form>
  </div>

  <script>
    async function generatePDF() {
      const { jsPDF } = window.jspdf;
      const form = document.getElementById("incidentForm");

      // Create a container for PDF content
      const pdfContent = document.createElement("div");
      pdfContent.innerHTML = `
        <div style="padding:20px; font-family:sans-serif;">
          <div style="text-align:center; margin-bottom:20px;">
            <img src='https://via.placeholder.com/150x50?text=Company+Logo' style="height:50px;" />
          </div>
          <h2 style="text-align:center; margin-bottom:20px;">GPS Damage / Lost Incident Report</h2>
          <p><b>Reporter Name:</b> ${form.reporter.value}</p>
          <p><b>Device ID / IMEI:</b> ${form.deviceId.value}</p>
          <p><b>Incident Type:</b> ${form.incidentType.value}</p>
          <p><b>Date:</b> ${form.date.value}</p>
          <p><b>Time:</b> ${form.time.value}</p>
          <p><b>Location:</b> ${form.location.value}</p>
          <p><b>Description:</b> ${form.description.value}</p>
          <p><b>Reference Number:</b> ${form.reference.value}</p>
          <div id='pdfImage'></div>
        </div>`;

      const file = document.getElementById("photo").files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = async function (e) {
          const img = document.createElement("img");
          img.src = e.target.result;
          img.style.maxWidth = "100%";
          document.getElementById("pdfImage").appendChild(img);

          await exportToPDF(pdfContent);
        };
        reader.readAsDataURL(file);
      } else {
        await exportToPDF(pdfContent);
      }
    }

    async function exportToPDF(content) {
      const { jsPDF } = window.jspdf;
      const canvas = await html2canvas(content, { scale: 2 });
      const imgData = canvas.toDataURL("image/png");
      const pdf = new jsPDF("p", "mm", "a4");

      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = (canvas.height * pdfWidth) / canvas.width;

      pdf.addImage(imgData, "PNG", 0, 0, pdfWidth, pdfHeight);
      pdf.save("gps_incident_report.pdf");
    }
  </script>
</body>
</html>
